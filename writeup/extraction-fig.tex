%!TEX root=./main.tex


\usetikzlibrary{decorations.pathmorphing}
\tikzset{snake/.style={decorate, decoration=snake},
q/.style={circle,fill=black,draw,minimum size=0.1cm,inner sep=0pt,label={$\epsilon$}},
                    o1/.style={circle,fill=black,draw,minimum size=0.1cm,inner sep=0pt},%label={$\inv_1$}},
                    o2/.style={circle,red,fill=red,draw,minimum size=0.1cm,inner sep=0pt},%label={$\inv_2$}},
                    o3/.style={circle,fill=black,draw,minimum size=0.1cm,inner sep=0pt},%label={$\inv_3$}},
                    }

\begin{figure}

\begin{tikzpicture}[->,
                    ]

\node[q]    (q1) {};
\node[o1]   (1o1) [right = 0.8cm of q1] {};
\node[o1]   (2o1) [right = 0.8cm of 1o1] {};
\node[o2]   (1o2) [right = 0.8cm of 2o1] {};
\node[o2]   (2o2) [right = 0.8cm of 1o2] {};
\node[o1]   (3o1) [right = 0.8cm of 2o2] {};
\node[q]    (q2) [right = 0.8cm of 3o1] {};
\node[o3]   (1o3) [right = 0.8cm of q2] {};
\node[q]    (q3) [right = 0.8cm of 1o3] {};

\path[draw, thick, every node/.style={anchor=south}]
(q1) edge node {\smaller{$\trid^1_1$}} (1o1);

\path[draw, dashed, every node/.style={anchor=south}]
(1o1) edge node {$\cdots$} (2o1);

\path[draw=red, thick, every node/.style={anchor=south}]
(2o1) edge node {\red{\smaller{$\trid^1_2$}}} (1o2);

\path[draw=red, dashed, every node/.style={anchor=south}]
(1o2) edge node {\red{$\cdots$}} (2o2);

\path[draw=red, thick, every node/.style={anchor=south}]
(2o2) edge node {\red{\smaller{$\trid^m_2$}}} (3o1);

\path[draw, thick, every node/.style={anchor=south}]
(3o1) edge node {\smaller{$\trid^n_1$}} (q2)
(q2) edge node {\smaller{$\trid^1_3$}} (1o3);

\path[draw, dashed, every node/.style={anchor=south}]
(1o3) edge node {$\cdots$} (q3);

\end{tikzpicture}


\hspace{+2.6cm}
\begin{tikzpicture}[->,
                    ]

\node[q]    (q1) {};
\node[o1]   (1o1) [right = 0.8cm of q1] {};
\node[o1]   (2o1) [right = 0.8cm of 1o1] {};
\node[o1]   (3o1) [right = 2.6cm of 2o1] {};
\node[q]    (q2) [right = 0.8cm of 3o1] {};
\node[o3]   (1o3) [right = 0.8cm of q2] {};
\node[q]    (q3) [right = 0.8cm of 1o3] {};
\node[o2]   (1o2) [right = 0.8cm of q3] {};
\node[o2]   (2o2) [right = 0.8cm of 1o2] {};
\node[q]    (q4) [right = 0.8cm of 2o2] {};

\path[draw, thick, every node/.style={anchor=south}]
(q1) edge node {\smaller{$\trid^1_1$}} (1o1);

\path[draw, dashed, every node/.style={anchor=south}]
(1o1) edge node {$\cdots$} (2o1);

\path[draw, snake, every node/.style={anchor=south}]
(2o1) -- (3o1);

\path[draw, thick, every node/.style={anchor=south}]
(3o1) edge node {\smaller{$\trid^n_1$}} (q2)
(q2) edge node {\smaller{$\trid^1_3$}} (1o3);

\path[draw, dashed, every node/.style={anchor=south}]
(1o3) edge node {$\cdots$} (q3);

\path[draw=red, thick, every node/.style={anchor=south}]
(q3) edge node {\red{\smaller{$\trid^1_2$}}} (1o2);

\path[draw=red, dashed, every node/.style={anchor=south}]
(1o2) edge node {\red{$\cdots$}} (2o2);

\path[draw=red, thick, every node/.style={anchor=south}]
(2o2) edge node {\red{\smaller{$\trid^m_2$}}} (q4);

\end{tikzpicture}

\hspace{+2.6cm}
\begin{tikzpicture}[->,
                    ]

\node[q]    (q1) {};
\node[o1]   (1o1) [right = 0.8cm of q1] {};
\node[o1]   (2o1) [right = 0.8cm of 1o1] {};
\node[o1]   (3o1) [right = 2.6cm of 2o1] {};
\node[q]    (q2) [right = 0.8cm of 3o1] {};
\node[o2]   (1o2) [right = 0.8cm of q2] {};
\node[o2]   (2o2) [right = 0.8cm of 1o2] {};
\node[q]    (q3) [right = 0.8cm of 2o2] {};
\node[o3]   (1o3) [right = 0.8cm of q3] {};
\node[q]    (q4) [right = 0.8cm of 1o3] {};

\path[draw, thick, every node/.style={anchor=south}]
(q1) edge node {\smaller{$\trid^1_1$}} (1o1);

\path[draw, dashed, every node/.style={anchor=south}]
(1o1) edge node {$\cdots$} (2o1);

\path[draw, snake, every node/.style={anchor=south}]
(2o1) -- (3o1);

\path[draw, thick, every node/.style={anchor=south}]
(3o1) edge node {\smaller{$\trid^n_1$}} (q2);

\path[draw=red, thick, every node/.style={anchor=south}]
(q2) edge node {\red{\smaller{$\trid^1_2$}}} (1o2);

\path[draw=red, dashed, every node/.style={anchor=south}]
(1o2) edge node {\red{$\cdots$}} (2o2);

\path[draw=red, thick, every node/.style={anchor=south}]
(2o2) edge node {\red{\smaller{$\trid^m_2$}}} (q3);

\path[draw, thick, every node/.style={anchor=south}]
(q3) edge node {\smaller{$\trid^1_3$}} (1o3);

\path[draw, dashed, every node/.style={anchor=south}]
(1o3) edge node {$\cdots$} (q4);
\end{tikzpicture}



\hspace{-2.9cm}
\begin{tikzpicture}[->,
                    ]

\node[q]    (q1) {};
\node[o2]   (1o2) [right = 0.8cm of q1] {};
\node[o2]   (2o2) [right = 0.8cm of 1o2] {};
\node[q]    (q2) [right = 0.8cm of 2o2] {};
\node[o1]   (1o1) [right = 0.8cm of q2] {};
\node[o1]   (2o1) [right = 0.8cm of 1o1] {};
\node[o1]   (3o1) [right = 2.6cm of 2o1] {};
\node[q]    (q3) [right = 0.8cm of 3o1] {};
\node[o3]   (1o3) [right = 0.8cm of q3] {};
\node[q]    (q4) [right = 0.8cm of 1o3] {};

\path[draw=red, thick, every node/.style={anchor=south}]
(q1) edge node {\red{\smaller{$\trid^1_2$}}} (1o2);

\path[draw=red, dashed, every node/.style={anchor=south}]
(1o2) edge node {\red{$\cdots$}} (2o2);

\path[draw=red, thick, every node/.style={anchor=south}]
(2o2) edge node {\red{\smaller{$\trid^m_2$}}} (q2);

\path[draw, thick, every node/.style={anchor=south}]
(q2) edge node {\smaller{$\trid^1_1$}} (1o1);

\path[draw, dashed, every node/.style={anchor=south}]
(1o1) edge node {} (2o1);

\path[draw, snake, every node/.style={anchor=south}]
(2o1) -- (3o1);

\path[draw, thick, every node/.style={anchor=south}]
(3o1) edge node {\smaller{$\trid^n_1$}} (q3)
(q3) edge node {\smaller{$\trid^1_3$}} (1o3);

\path[draw, dashed, every node/.style={anchor=south}]
(1o3) edge node {$\cdots$} (q4);

\end{tikzpicture}
\caption{The callback reorder process. 
The first graph represents the original execution, which contains a callback (in red).
The three other graphs represent all possible callback free executions.
Red marks the moved callback transitions.
Wave edges indicate that a call was replaced with a havoc transition.
}\label{fig:CallbackExtraction}
\end{figure}